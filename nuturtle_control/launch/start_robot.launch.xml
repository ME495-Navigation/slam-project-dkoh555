<!-- 
    Load the delta component description of the omnid and possibly visualize it in rviz
-->  
<launch>
    <arg name="cmd_src" default="teleop" />
    <arg name="robot" default="nusim"/>
    <arg name="use_rviz" default="true"/>
    
    <!--  -->
    <group if="$(eval '\'$(var robot)\' != \'none\'')">
        <group if="$(eval '\'$(var cmd_src)\' == \'circle\'')">

            <node name="circle" pkg ="nuturtle_control" exec="circle"/> 

        </group>

        <group if="$(eval '\'$(var cmd_src)\' == \'teleop\'')">

            <node name="teleop_twist_keyboard" pkg ="teleop_twist_keyboard" exec="teleop_twist_keyboard"
                output="screen" launch-prefix="xterm -e" /> 

        </group>
    </group>

    <!--  -->
    <group if="$(eval '\'$(var robot)\' == \'nusim\'')">

        <node pkg="nusim" exec="nusim">
            <param from="$(find-pkg-share nusim)/config/basic_world.yaml"/>
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
        </node>

        <node pkg="nuturtle_control" exec="odometry">
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
            <param name="body_id" value="blue/base_footprint"/>
            <param name="wheel_left" value="wheel_left_joint"/>
            <param name="wheel_right" value="wheel_right_joint"/>
            <remap from="joint_states" to="blue/joint_states" />
        </node>

        <node pkg="nuturtle_control" exec="turtle_control">
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
            <remap from="joint_states" to="blue/joint_states" />
            <remap from="wheel_cmd" to="red/wheel_cmd" />
            <remap from="sensor_data" to="red/sensor_data" />
        </node>

        <group>
            <push-ros-namespace namespace="red"/>
            <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py" >
                <arg name="color" value="red"/>
                <arg name="use_rviz" value="false"/>
                <arg name="use_jsp" value="true"/>
            </include>
        </group>
        
        <node pkg="tf2_ros"
            exec="static_transform_publisher"
            name="world_odom_broadcaster"
            args="--frame-id nusim/world 
                    --child-frame-id odom
                    --x 0 
                    --y 0 
                    --z 0 
                    --qx 0.0 
                    --qy 0.0 
                    --qz 0.0 
                    --qw 1.0"/>

    </group>

    <!--  -->
    <group if="$(eval '\'$(var robot)\' == \'localhost\'')">

        <node name="numsr_turtlebot" pkg ="numsr_turtlebot" exec="numsr_turtlebot"/> 

        <node pkg="nuturtle_control" exec="turtle_control">
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
            <remap from="joint_states" to="blue/joint_states" />
            <!-- <remap from="wheel_cmd" to="red/wheel_cmd" />
            <remap from="sensor_data" to="red/sensor_data" /> -->
        </node>

        <node pkg="tf2_ros"
            exec="static_transform_publisher"
            name="world_odom_broadcaster"
            args="--frame-id nusim/world 
                    --child-frame-id odom
                    --x 0 
                    --y 0 
                    --z 0 
                    --qx 0.0 
                    --qy 0.0 
                    --qz 0.0 
                    --qw 1.0"/>

    </group>

    <!--  -->
    <group if="$(eval '\'$(var robot)\' != \'localhost\'')">
    
        <group>
            <push-ros-namespace namespace="blue"/>
            <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py" >
                <arg name="color" value="blue"/>
                <arg name="use_rviz" value="false"/>
                <arg name="use_jsp" value="false"/>
            </include>
        </group>

        <node if="$(eval '\'$(var use_rviz)\' == \'true\'')"
            name="rviz2"
            pkg ="rviz2"
            exec="rviz2"
            args="-d $(find-pkg-share nusim)/config/nusim.rviz" /> 

    </group>

</launch>
