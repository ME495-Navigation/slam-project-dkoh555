<!-- 
    Load the delta component description of the omnid and possibly visualize it in rviz
-->  
<launch>
    <arg name="cmd_src" default="circle" />
    <arg name="robot" default="nusim"/>
    <arg name="use_rviz" default="true"/>
    
    <!--  -->
    <group if="$(eval '\'$(var cmd_src)\' == \'circle\'')">

        <node name="circle" pkg ="nuturtle_control" exec="circle"/> 

    </group>

    <group if="$(eval '\'$(var cmd_src)\' == \'teleop\'')">

        <node name="teleop_twist_keyboard" pkg ="teleop_twist_keyboard" exec="teleop_twist_keyboard"
            output="screen" launch-prefix="xterm -e" /> 

    </group>

    <!--  -->
    <group if="$(eval '\'$(var robot)\' == \'nusim\'')">

        <node pkg="nusim" exec="nusim">
            <param from="$(find-pkg-share nusim)/config/basic_world.yaml"/>
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
        </node>

        <node pkg="nuturtle_control" exec="odometry">
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
            <param name="body_id" value="red/body_link"/>
            <param name="wheel_left" value="red/wheel_left_joint"/>
            <param name="wheel_right" value="red/wheel_right_joint"/>
            <remap from="joint_states" to="red/joint_states" />
        </node>

        <node pkg="nuturtle_control" exec="turtle_control">
            <param from="$(find-pkg-share nuturtle_description)/config/diff_params.yaml"/>
            <remap from="joint_states" to="red/joint_states" />
            <remap from="wheel_cmd" to="red/wheel_cmd" />
        </node>

        <group>
            <push-ros-namespace namespace="red"/>
            <include file="$(find-pkg-share nuturtle_description)/launch/load_one.launch.py" >
                <arg name="color" value="red"/>
                <arg name="use_rviz" value="false"/>
                <arg name="use_jsp" value="false"/>
            </include>

            <node 
                name="joint_state_publisher" 
                pkg="joint_state_publisher"
                exec="joint_state_publisher" >
            </node>
        </group>
        
    </group>

    <node pkg="tf2_ros"
    exec="static_transform_publisher"
    name="world_odom_broadcaster"
    args="--frame-id nusim/world 
            --child-frame-id odom
            --x 0 
            --y 0 
            --z 0 
            --qx 0.0 
            --qy 0.0 
            --qz 0.0 
            --qw 1.0"/>

    <!--  -->
    <group if="$(eval '\'$(var robot)\' == \'nusim\'')">

        <node if="$(eval '\'$(var use_rviz)\' == \'true\'')"
            name="rviz2"
            pkg ="rviz2"
            exec="rviz2"
            args="-d $(find-pkg-share nusim)/config/nusim.rviz" /> 
        
    </group>

</launch>
